var deBouncer=function(e,t,i,n){var o=function(e,t,i){var o;return function a(){function a(){i||e.apply(r,s),o=null}var r=this,s=arguments;o?clearTimeout(o):i&&e.apply(r,s),o=setTimeout(a,t||n)}};jQuery.fn[t]=function(e){return e?this.bind(i,o(e)):this.trigger(t)}};deBouncer(jQuery,"smartresize","resize",100),deBouncer(jQuery,"smartscroll","scroll",100),function(e,t,i,n){var o=e(t);e.fn.lazyload=function(a){function r(){var t=0;s.each(function(){var i=e(this);if(!c.skip_invisible||i.is(":visible"))if(e.abovethetop(this,c)||e.leftofbegin(this,c));else if(e.belowthefold(this,c)||e.rightoffold(this,c)){if(++t>c.failure_limit)return!1}else i.trigger("appear"),t=0})}var s=this,l,c={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return a&&(n!==a.failurelimit&&(a.failure_limit=a.failurelimit,delete a.failurelimit),n!==a.effectspeed&&(a.effect_speed=a.effectspeed,delete a.effectspeed),e.extend(c,a)),l=c.container===n||c.container===t?o:e(c.container),0===c.event.indexOf("scroll")&&l.bind(c.event,function(){return r()}),this.each(function(){var t=this,i=e(t);t.loaded=!1,(i.attr("src")===n||i.attr("src")===!1)&&i.is("img")&&i.attr("src",c.placeholder),i.one("appear",function(){if(!this.loaded){if(c.appear){var n=s.length;c.appear.call(t,n,c)}e("<img />").bind("load",function(){var n=i.attr("data-"+c.data_attribute);i.hide(),i.is("img")?i.attr("src",n):i.css("background-image","url('"+n+"')"),i[c.effect](c.effect_speed),t.loaded=!0;var o=e.grep(s,function(e){return!e.loaded});if(s=e(o),c.load){var a=s.length;c.load.call(t,a,c)}}).attr("src",i.attr("data-"+c.data_attribute))}}),0!==c.event.indexOf("scroll")&&i.bind(c.event,function(){t.loaded||i.trigger("appear")})}),o.bind("resize",function(){r()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&s.each(function(){e(this).trigger("appear")})}),e(i).ready(function(){r()}),this},e.belowthefold=function(i,a){var r;return r=a.container===n||a.container===t?(t.innerHeight?t.innerHeight:o.height())+o.scrollTop():e(a.container).offset().top+e(a.container).height(),r<=e(i).offset().top-a.threshold},e.rightoffold=function(i,a){var r;return r=a.container===n||a.container===t?o.width()+o.scrollLeft():e(a.container).offset().left+e(a.container).width(),r<=e(i).offset().left-a.threshold},e.abovethetop=function(i,a){var r;return r=a.container===n||a.container===t?o.scrollTop():e(a.container).offset().top,r>=e(i).offset().top+a.threshold+e(i).height()},e.leftofbegin=function(i,a){var r;return r=a.container===n||a.container===t?o.scrollLeft():e(a.container).offset().left,r>=e(i).offset().left+a.threshold+e(i).width()},e.inviewport=function(t,i){return!(e.rightoffold(t,i)||e.leftofbegin(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),function(e){var t={numOfCol:5,offsetX:5,offsetY:5,blockElement:"div"},i,n,o=[];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=t);t>i;i++)if(i in this&&this[i]===e)return i;return-1});var a=function(){o=[];for(var e=0;e<t.numOfCol;e++)r("empty-"+e,e,0,1,-t.offsetY)},r=function(e,i,n,a,r){for(var s=0;a>s;s++){var l={};l.x=i+s,l.size=a,l.endY=n+r+2*t.offsetY,o.push(l)}},s=function(e,t){for(var i=0;t>i;i++){var n=l(e+i,"x");o.splice(n,1)}},l=function(e,t){for(var i=0;i<o.length;i++){var n=o[i];if("x"==t&&n.x==e)return i;if("endY"==t&&n.endY==e)return i}},c=function(e,t){for(var i=[],n=0;t>n;n++)i.push(o[l(e+n,"x")].endY);var a=Math.min.apply(Math,i),r=Math.max.apply(Math,i);return[a,r,i.indexOf(a)]},f=function(e){if(e>1){for(var t=o.length-e,i=!1,n,a,r=0;r<o.length;r++){var s=o[r],l=s.x;if(l>=0&&t>=l){var f=c(l,e);i?f[1]<n[1]&&(n=f,a=l):(i=!0,n=f,a=l)}}return[a,n[1]]}return n=c(0,o.length),[n[2],n[0]]},d=function(e,i){!e.data("size")||e.data("size")<0?e.data("size",1):e.data("size")>t.numOfCol&&e.data("size",t.numOfCol);var o=f(e.data("size")),a=n*e.data("size")-(e.outerWidth()-e.width());e.css({width:a-2*t.offsetX,left:o[0]*n,top:o[1],position:"absolute"});var l=e.outerHeight();s(o[0],e.data("size")),r(e.attr("id"),o[0],o[1],e.data("size"),l)};e.fn.BlocksIt=function(r){r&&"object"==typeof r&&e.extend(t,r),i=e(this),n=i.width()/t.numOfCol,a(),i.children(t.blockElement).each(function(t){d(e(this),t)});var s=c(0,o.length);return i.height(s[1]+t.offsetY),this}}(jQuery);var lbApp={};lbApp.reArrange=function(){$.event.trigger({type:"reArrangePosts"})},$(window).load(function(){"timeline"===global_viewtype&&lbApp.Posts.init({viewtype:"timeline",$wrapper:$("#posts"),superContainer:".timeline-post",container:".timeline-post"}),"compact"===global_viewtype&&lbApp.Posts.init({viewtype:"compact",$wrapper:$("#posts"),superContainer:".compact",container:".compact"}),$(document).on("click","button[data-action], .action",function(e){e.preventDefault(),e.stopPropagation();var action=$(this).data("action"),funct;(funct=eval("lbApp."+action))($(this))}),lbApp.interfaceElements.init(),lbApp.reArrange(),lbApp.interfaceElements.viewArea.revealContent()}),lbApp.interfaceElements={init:function(){this.viewArea.adjust(),this.sidebar.init(),this.header.menus.init()},header:{$header:$(".mainbar-wrapper"),menus:{init:function(){$("#menu-icons > li").on("click",function(){if($(this).hasClass("selected"))$(".menu").hide(),$(this).removeClass("selected");else{$(".menu").hide(),$("#menu-icons > li").removeClass("selected"),$(this).addClass("selected");var e=$(this).data("menu");$("#"+e).show(),"menu-search"==e&&$("#search-box").focus()}})}}},sidebar:{$sideBar:$("div#left-col-wrapper"),adjust:function(){this.$sideBar.css("height",$(window).outerHeight())},init:function(){this.adjust(),$(window).width()<768||"closed"===global_leftColumnInitialState?this.hide():this.show()},hide:function(){this.$sideBar.hide(),$("#hamburger").show()},show:function(){this.$sideBar.show(),$("#hamburger").hide()},visible:function(){return"block"===this.$sideBar.css("display")?!0:!1}},viewArea:{$viewArea:$("#view-area"),cardWidth:320,adjust:function(){this.$viewArea.css("height",$(window).outerHeight()-lbApp.interfaceElements.header.$header.outerHeight())},numberOfColumns:function(){return Math.floor(this.$viewArea.outerWidth()/this.cardWidth)},windowWidth:function(){return this.numberOfColumns()*this.cardWidth},revealContent:function(){$(".loader").fadeTo("fast",0,function(){$("#view-area").fadeTo("fast",1)})}}},$("#hamburger").on("click",function(e){lbApp.interfaceElements.sidebar.show(),lbApp.reArrange()}),$(".leftNav-dismiss").on("click",function(e){lbApp.interfaceElements.sidebar.hide(),lbApp.reArrange()}),$(window).smartresize(function(){lbApp.reArrange()}),$(document).ready(function(){$("#view-area").css("-webkit-overflow-scrolling","touch")}),lbApp.Posts={isUpdating:"no",config:{viewtype:"cards",$wrapper:$("#posts"),superContainer:".card-container",container:".card"},init:function(e){e&&"object"==typeof e&&(console.log("ok"),$.extend(lbApp.Posts.config,e))},distanceToBottom:function(){return thePosts=this.config.$wrapper,thePosts.height()+thePosts.position().top},flow:function(){if(thePosts=this.config.$wrapper,"cards"===this.config.viewtype){thePosts.css("width",lbApp.interfaceElements.viewArea.windowWidth()),thePosts.css("margin","0 auto");var e=lbApp.interfaceElements.viewArea.numberOfColumns();$(".divider").each(function(){$(this).css({width:320*e+"px"}),$(this).attr({"data-size":e})}),thePosts.BlocksIt({numOfCol:e,offsetX:10,offsetY:10,blockElement:this.config.superContainer})}},show:function(){$(this.config.container).css("opacity",1),$(this.config.superContainer).css("opacity",1)},hide:function(){$(this.container).fadeTo("slow",0)},addNew:function(){var e;if(lbApp.Posts.isUpdating="yes","favorites"===global_page)e="contr_get_favorites_extra_posts.php";else if("saved"===global_page)e="contr_get_saved_extra_posts.php";else if("browse"===global_page)e="contr_get_extra_posts.php";else if("blogger"===global_page)return;$.post(e,function(e){lbApp.Posts.config.$wrapper.append(e),lbApp.reArrange(),lbApp.Posts.isUpdating="no",console.log("updating done")})}},$("#view-area").smartscroll(function(){var e=lbApp.Posts.distanceToBottom(),t=$(this).height(),i=e-t;1.4*t>i&&"no"==lbApp.Posts.isUpdating&&"search"!=global_page&&(console.log("updating now"),lbApp.Posts.addNew())}),$(document).on("reArrangePosts",function(){lbApp.Posts.flow(),lbApp.Posts.show(),$("img.lazy").lazyload({container:$("#view-area")})}),lbApp.Search={init:function(e){this.searchTerm=e,console.log("searching blog names"),lbApp.Search.search(e,"blognames","Names",function(){console.log("searching blog titles"),lbApp.Search.search(e,"blogtitles","Titles",function(){console.log("searching blog contents"),lbApp.Search.search(e,"blogcontents","Content",function(){console.log("done searching")})})})},search:function(e,t,i,n){$.post("contr_search.php",{term:e,scope:t,description:i},function(n){howManyResults=$(n).find(".card").length;var o=lbApp.Search.makeHeader(e,i,howManyResults),a;a=howManyResults>0?o+n:"",$("#posts").find("#placeHolder_"+t).replaceWith(a),lbApp.reArrange()}),"function"==typeof n&&n()},makeHeader:function(e,t,i){var n;n="Names"==t?"Blogs":"Blog posts";var o=n+' with the phrase "'+e+'" in their '+t+": "+i,a=lbApp.interfaceElements.viewArea.numberOfColumns();return'<div class ="card-container divider" style="opacity:0" data-size="'+a+'"><div style ="background:white"><p>'+o+"</p></div></div>"}},"search"===global_page&&$(document).ready(function(){}),lbApp.addToFavorites=function(e){var t=e.data("user"),i=e.data("blog");$(".card[data-blogid='"+i+"']").each(function(){$(this).find(".addToFav").removeClass("addToFav").addClass("updating")}),$.ajax({type:"POST",url:"contr_toggle_favorites.php",data:{blog:i,user:t},success:function(){$(".card[data-blogid='"+i+"']").each(function(){$(this).find(".updating").data("action","removeFromFavorites"),$(this).find(".updating").removeClass("updating").addClass("removeFromFav")})}})},lbApp.removeFromFavorites=function(e){var t=e.data("user"),i=e.data("blog");$(".card[data-blogid='"+i+"']").each(function(){$(this).find(".removeFromFav").removeClass("removeFromFav").addClass("updating")}),$.ajax({type:"POST",url:"contr_toggle_favorites.php",data:{blog:i,user:t},success:function(){$(".card[data-blogid='"+i+"']").each(function(){$(this).find(".updating").data("action","addToFavorites"),$(this).find(".updating").removeClass("updating").addClass("addToFav")})}})},lbApp.removeFromList=function(e){e.find(".message").html("working.."),$.ajax({type:"POST",url:"contr_toggle_saved.php",data:{url:e.data("url"),user:e.data("user")},success:function(){e.data("action","addToList"),e.find(".message").html('<i class="fa fa-clock-o"></i> Read Later'),$figure=$("#readingListCounter .theFigure");var t=$figure.text();t=Number(t)-1,$figure.text(t)}})},lbApp.addToList=function(e){e.find(".message").html("working.."),$.ajax({type:"POST",url:"contr_toggle_saved.php",data:{url:e.data("url"),user:e.data("user")},success:function(){e.data("action","removeFromList"),e.find(".message").html('<i class="fa fa-list-alt selected"></i> Listed'),$figure=$("#readingListCounter .theFigure");var t=$figure.text();t=Number(t)+1,$figure.text(t)}})};