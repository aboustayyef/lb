var deBouncer=function(e,t,i,n){var o=function(e,t,i){var o;return function r(){function r(){i||e.apply(a,s),o=null}var a=this,s=arguments;o?clearTimeout(o):i&&e.apply(a,s),o=setTimeout(r,t||n)}};jQuery.fn[t]=function(e){return e?this.bind(i,o(e)):this.trigger(t)}};deBouncer(jQuery,"smartresize","resize",100),deBouncer(jQuery,"smartscroll","scroll",100),function(e,t,i,n){var o=e(t);e.fn.lazyload=function(r){function a(){var t=0;s.each(function(){var i=e(this);if(!f.skip_invisible||i.is(":visible"))if(e.abovethetop(this,f)||e.leftofbegin(this,f));else if(e.belowthefold(this,f)||e.rightoffold(this,f)){if(++t>f.failure_limit)return!1}else i.trigger("appear"),t=0})}var s=this,l,f={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return r&&(n!==r.failurelimit&&(r.failure_limit=r.failurelimit,delete r.failurelimit),n!==r.effectspeed&&(r.effect_speed=r.effectspeed,delete r.effectspeed),e.extend(f,r)),l=f.container===n||f.container===t?o:e(f.container),0===f.event.indexOf("scroll")&&l.bind(f.event,function(){return a()}),this.each(function(){var t=this,i=e(t);t.loaded=!1,(i.attr("src")===n||i.attr("src")===!1)&&i.is("img")&&i.attr("src",f.placeholder),i.one("appear",function(){if(!this.loaded){if(f.appear){var n=s.length;f.appear.call(t,n,f)}e("<img />").bind("load",function(){var n=i.attr("data-"+f.data_attribute);i.hide(),i.is("img")?i.attr("src",n):i.css("background-image","url('"+n+"')"),i[f.effect](f.effect_speed),t.loaded=!0;var o=e.grep(s,function(e){return!e.loaded});if(s=e(o),f.load){var r=s.length;f.load.call(t,r,f)}}).attr("src",i.attr("data-"+f.data_attribute))}}),0!==f.event.indexOf("scroll")&&i.bind(f.event,function(){t.loaded||i.trigger("appear")})}),o.bind("resize",function(){a()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&o.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&s.each(function(){e(this).trigger("appear")})}),e(i).ready(function(){a()}),this},e.belowthefold=function(i,r){var a;return a=r.container===n||r.container===t?(t.innerHeight?t.innerHeight:o.height())+o.scrollTop():e(r.container).offset().top+e(r.container).height(),a<=e(i).offset().top-r.threshold},e.rightoffold=function(i,r){var a;return a=r.container===n||r.container===t?o.width()+o.scrollLeft():e(r.container).offset().left+e(r.container).width(),a<=e(i).offset().left-r.threshold},e.abovethetop=function(i,r){var a;return a=r.container===n||r.container===t?o.scrollTop():e(r.container).offset().top,a>=e(i).offset().top+r.threshold+e(i).height()},e.leftofbegin=function(i,r){var a;return a=r.container===n||r.container===t?o.scrollLeft():e(r.container).offset().left,a>=e(i).offset().left+r.threshold+e(i).width()},e.inviewport=function(t,i){return!(e.rightoffold(t,i)||e.leftofbegin(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window,document),function(e){var t={numOfCol:5,offsetX:5,offsetY:5,blockElement:"div"},i,n,o=[];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=t);t>i;i++)if(i in this&&this[i]===e)return i;return-1});var r=function(){o=[];for(var e=0;e<t.numOfCol;e++)a("empty-"+e,e,0,1,-t.offsetY)},a=function(e,i,n,r,a){for(var s=0;r>s;s++){var l={};l.x=i+s,l.size=r,l.endY=n+a+2*t.offsetY,o.push(l)}},s=function(e,t){for(var i=0;t>i;i++){var n=l(e+i,"x");o.splice(n,1)}},l=function(e,t){for(var i=0;i<o.length;i++){var n=o[i];if("x"==t&&n.x==e)return i;if("endY"==t&&n.endY==e)return i}},f=function(e,t){for(var i=[],n=0;t>n;n++)i.push(o[l(e+n,"x")].endY);var r=Math.min.apply(Math,i),a=Math.max.apply(Math,i);return[r,a,i.indexOf(r)]},c=function(e){if(e>1){for(var t=o.length-e,i=!1,n,r,a=0;a<o.length;a++){var s=o[a],l=s.x;if(l>=0&&t>=l){var c=f(l,e);i?c[1]<n[1]&&(n=c,r=l):(i=!0,n=c,r=l)}}return[r,n[1]]}return n=f(0,o.length),[n[2],n[0]]},h=function(e,i){!e.data("size")||e.data("size")<0?e.data("size",1):e.data("size")>t.numOfCol&&e.data("size",t.numOfCol);var o=c(e.data("size")),r=n*e.data("size")-(e.outerWidth()-e.width());e.css({width:r-2*t.offsetX,left:o[0]*n,top:o[1],position:"absolute"});var l=e.outerHeight();s(o[0],e.data("size")),a(e.attr("id"),o[0],o[1],e.data("size"),l)};e.fn.BlocksIt=function(a){a&&"object"==typeof a&&e.extend(t,a),i=e(this),n=i.width()/t.numOfCol,r(),i.children(t.blockElement).each(function(t){h(e(this),t)});var s=f(0,o.length);return i.height(s[1]+t.offsetY),this}}(jQuery);var lbApp={};lbApp.reArrange=function(){$.event.trigger({type:"reArrangePosts"})},$(window).load(function(){"timeline"===global_viewtype&&(console.log("setting timeline"),lbApp.Posts.init({viewtype:"timeline",$wrapper:$("#posts"),superContainer:".timeline-post",container:".timeline-post"})),"compact"===global_viewtype&&(console.log("setting compact"),lbApp.Posts.init({viewtype:"compact",$wrapper:$("#posts"),superContainer:".compact",container:".compact"})),lbApp.interfaceElements.init(),lbApp.reArrange(),lbApp.interfaceElements.viewArea.revealContent()}),lbApp.interfaceElements={init:function(){this.viewArea.adjust(),this.sidebar.init(),this.header.menus.init()},header:{$header:$(".mainbar-wrapper"),menus:{init:function(){$("#menu-icons > li").on("click",function(){if($(this).hasClass("selected"))$(".menu").hide(),$(this).removeClass("selected");else{$(".menu").hide(),$("#menu-icons > li").removeClass("selected"),$(this).addClass("selected");var e=$(this).data("menu");$("#"+e).show(),"menu-search"==e&&$("#search-box").focus()}})}}},sidebar:{$sideBar:$("div#left-col-wrapper"),adjust:function(){this.$sideBar.css("height",$(window).outerHeight())},init:function(){this.adjust(),$(window).width()<768||"closed"===global_leftColumnInitialState?this.hide():this.show()},hide:function(){this.$sideBar.hide(),$("#hamburger").show()},show:function(){this.$sideBar.show(),$("#hamburger").hide()},visible:function(){return"block"===this.$sideBar.css("display")?!0:!1}},viewArea:{$viewArea:$("#view-area"),cardWidth:320,adjust:function(){this.$viewArea.css("height",$(window).outerHeight()-lbApp.interfaceElements.header.$header.outerHeight())},numberOfColumns:function(){return Math.floor(this.$viewArea.outerWidth()/this.cardWidth)},windowWidth:function(){return this.numberOfColumns()*this.cardWidth},revealContent:function(){$(".loader").fadeTo("fast",0,function(){$("#view-area").fadeTo("fast",1)})}}},$("#hamburger").on("click",function(e){lbApp.interfaceElements.sidebar.show(),lbApp.reArrange()}),$(".leftNav-dismiss").on("click",function(e){lbApp.interfaceElements.sidebar.hide(),lbApp.reArrange()}),$(window).smartresize(function(){lbApp.reArrange()}),lbApp.Posts={isUpdating:"no",config:{viewtype:"cards",$wrapper:$("#posts"),superContainer:".card-container",container:".card"},init:function(e){e&&"object"==typeof e&&(console.log("ok"),$.extend(lbApp.Posts.config,e))},distanceToBottom:function(){return thePosts=this.config.$wrapper,thePosts.height()+thePosts.position().top},flow:function(){thePosts=this.config.$wrapper,"cards"===this.config.viewtype&&(thePosts.css("width",lbApp.interfaceElements.viewArea.windowWidth()),thePosts.css("margin","0 auto"),thePosts.BlocksIt({numOfCol:lbApp.interfaceElements.viewArea.numberOfColumns(),offsetX:10,offsetY:10,blockElement:this.config.superContainer}))},show:function(){$(this.config.container).css("opacity",1)},hide:function(){$(this.container).fadeTo("slow",0)},addNew:function(){var e;lbApp.Posts.isUpdating="yes",e="favorites"===global_page?"contr_get_favorites_extra_posts.php":"saved"===global_page?"contr_get_saved_extra_posts.php":"contr_get_extra_posts.php",$.post(e,function(e){lbApp.Posts.config.$wrapper.append(e),lbApp.reArrange(),lbApp.Posts.isUpdating="no",console.log("updating done")})}},$("#view-area").smartscroll(function(){var e=lbApp.Posts.distanceToBottom(),t=$(this).height(),i=e-t;1.4*t>i&&"no"==lbApp.Posts.isUpdating&&(console.log("updating now"),lbApp.Posts.addNew())}),$(document).on("reArrangePosts",function(){lbApp.Posts.flow(),lbApp.Posts.show(),$("img.lazy").lazyload({container:$("#view-area")})});